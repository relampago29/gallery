(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{890:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var s=a(5155),r=a(2115),i=a(5801),l=a(2289);function n(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)(void 0),[o,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(null),[p,h]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[f,b]=(0,r.useState)(!1),[g,w]=(0,r.useState)("");async function y(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){h(!0),x(null);let{items:e,nextCursor:t}=await (0,l.Dv)({limitN:24,categoryId:a,cursor:null,forceApi:!0}).catch(e=>(x((null==e?void 0:e.message)||"Erro a carregar"),{items:[],nextCursor:null}));c(e),u(null!=t?t:null),b(!t),h(!1)}else{if(p||f)return;h(!0);let{items:e,nextCursor:t}=await (0,l.Dv)({limitN:24,categoryId:a,cursor:d,forceApi:!0}).catch(e=>(x((null==e?void 0:e.message)||"Erro a carregar"),{items:[],nextCursor:null}));c(t=>[...t,...e]),u(null!=t?t:null),b(!t),h(!1)}}(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,i.T)();t(e.map(e=>({id:e.id,name:e.name})))}catch(e){console.error("categories load failed:",e),t([])}})()},[]),(0,r.useEffect)(()=>{y(!0)},[a]);let v=(0,r.useMemo)(()=>{let e=g.trim().toLowerCase();return e?o.filter(t=>(t.title||"").toLowerCase().includes(e)):o},[o,g]);async function j(e){if(confirm("Apagar esta foto?"))try{await (0,l.fB)(e),c(t=>t.filter(t=>t.id!==e))}catch(e){console.error("delete failed",e),alert((null==e?void 0:e.message)||"Falha ao apagar")}}return(0,s.jsxs)("main",{className:"relative min-h-screen overflow-hidden bg-[#030303] text-gray-100",children:[(0,s.jsxs)("div",{className:"pointer-events-none absolute inset-0 before:absolute before:inset-0 before:bg-[radial-gradient(circle_at_top,_rgba(255,255,255,0.08),_transparent_60%)] before:content-['']",children:[(0,s.jsx)("div",{className:"absolute left-0 top-24 h-72 w-72 rounded-full bg-[#7c3aed1f] blur-3xl"}),(0,s.jsx)("div",{className:"absolute right-0 bottom-0 h-96 w-96 rounded-full bg-[#f472b61f] blur-3xl"})]}),(0,s.jsxs)("div",{className:"relative z-10 mx-auto max-w-6xl space-y-10 py-12 px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("header",{className:"flex flex-col gap-4 text-center sm:flex-row sm:items-center sm:justify-between sm:text-left",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:"Admin"}),(0,s.jsx)("h1",{className:"text-4xl font-semibold text-white tracking-tight",children:"Portf\xf3lio \xb7 Lista"}),(0,s.jsx)("p",{className:"text-sm text-white/70",children:"Filtra por categoria, pesquisa por t\xedtulo e gere rapidamente as fotos p\xfablicas."})]}),(0,s.jsx)("div",{className:"w-full sm:max-w-xs",children:(0,s.jsx)("input",{className:"w-full rounded-2xl border border-white/15 bg-white/10 px-4 py-2 text-white placeholder-white/60 focus:border-white/50 focus:outline-none",placeholder:"Pesquisar t\xedtulo…",value:g,onChange:e=>w(e.target.value)})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsx)("button",{className:"rounded-full px-4 py-1.5 text-sm font-medium transition ".concat(a?"border border-white/20 bg-transparent text-white/70 hover:border-white/40":"bg-white text-gray-900"),onClick:()=>n(void 0),children:"Todas"}),e.map(e=>(0,s.jsx)("button",{onClick:()=>n(e.id),className:"rounded-full px-4 py-1.5 text-sm font-medium transition ".concat(a===e.id?"bg-white text-gray-900":"border border-white/20 bg-transparent text-white/70 hover:border-white/40"),children:e.name},e.id))]}),(0,s.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 shadow-[0_25px_120px_rgba(0,0,0,0.45)] backdrop-blur-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2 border-b border-white/10 px-6 py-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsx)("div",{className:"font-semibold text-white",children:"Resultados"}),(0,s.jsxs)("div",{className:"text-sm text-white/60",children:[v.length," itens"]})]}),m&&(0,s.jsx)("div",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"rounded-2xl border border-red-400/40 bg-red-500/10 px-4 py-3 text-sm text-red-100",children:m.includes("index")||m.includes("FAILED_PRECONDITION")?"A consulta precisa de um \xedndice Firestore. Faz deploy dos \xedndices.":m})}),p&&0===o.length?(0,s.jsx)("div",{className:"px-6 py-10 text-center text-white/60",children:"A carregar…"}):0===v.length?(0,s.jsx)("div",{className:"px-6 py-10 text-center text-white/60",children:"Sem resultados."}):(0,s.jsx)("div",{className:"grid gap-6 px-6 py-6 sm:grid-cols-2 lg:grid-cols-3",children:v.map(e=>{let t=(0,l.Gu)(e);return(0,s.jsxs)("div",{className:"overflow-hidden rounded-3xl border border-white/10 bg-white/5 shadow-[0_20px_80px_rgba(0,0,0,0.45)] backdrop-blur-sm",children:[(0,s.jsx)("div",{className:"aspect-[4/3] bg-white/10",children:t.src?(0,s.jsx)("img",{src:t.src,alt:e.alt||e.title||"Foto",className:"h-full w-full object-cover"}):(0,s.jsx)("div",{className:"flex h-full items-center justify-center text-sm text-white/60",children:"processing"===e.status?"A gerar variantes…":"Sem preview"})}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 px-5 py-4",children:[(0,s.jsxs)("div",{className:"min-w-0 text-sm text-white/90",children:[(0,s.jsx)("div",{className:"truncate text-base font-medium",children:e.title||"(sem t\xedtulo)"}),(0,s.jsx)("div",{className:"text-xs uppercase tracking-wide text-white/50",children:e.status||"—"})]}),(0,s.jsx)("button",{className:"rounded-full border border-red-400/70 px-4 py-1 text-xs text-red-100 hover:bg-red-500/10",onClick:()=>j(e.id),children:"Apagar"})]})]},e.id)})}),(0,s.jsx)("div",{className:"border-t border-white/10 px-6 py-4 text-center",children:(0,s.jsx)("button",{className:"rounded-full border border-white/30 px-4 py-1.5 text-sm text-white hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/50 disabled:opacity-40",onClick:()=>y(!1),disabled:p||f,children:f?"N\xe3o h\xe1 mais":p?"A carregar…":"Carregar mais"})})]})]})]})}},2289:(e,t,a)=>{"use strict";a.d(t,{Dv:()=>n,FC:()=>u,Gu:()=>l,UM:()=>o,XC:()=>p,fB:()=>c});var s=a(8214),r=a(5317),i=a(858);function l(e){let t=e.sizes||{},a=t["960"]||t["800"]||t["640"]||Object.values(t)[0];return(null==a?void 0:a.jpg)?{src:a.jpg,w:a.width,h:a.height}:{}}async function n(e){let{limitN:t,categoryId:a,cursor:i,forceApi:l}=e;try{var n;let e=new URLSearchParams;e.set("limit",String(t)),a&&e.set("categoryId",a),null!=i&&e.set("cursor",String(i));let s=await fetch("/api/public-photos/list?".concat(e.toString()),{cache:"no-store"});if(!s.ok)throw Error(await s.text());let r=await s.json();return{items:r.items||[],nextCursor:null!=(n=r.nextCursor)?n:null}}catch(e){if(l)throw Error((null==e?void 0:e.message)?String(e.message):String(e))}let o=[(0,r._M)("published","==",!0),(0,r.My)("createdAt","desc"),(0,r.AB)(t)];a&&o.unshift((0,r._M)("categoryId","==",a)),null!=i&&o.push((0,r.HM)(i));let c=(await (0,r.GG)((0,r.P)((0,r.rJ)(s.db,"public_photos"),...o))).docs.map(e=>({id:e.id,...e.data()})),d=c.length?c[c.length-1].createdAt:null;return{items:c,nextCursor:d}}async function o(e){let t=(e.file.name.split(".").pop()||"jpg").toLowerCase(),a="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()),l="masters/public/".concat(a,".").concat(t),n=(0,i.bp)((0,i.KR)(s.I,l),e.file,{contentType:e.file.type});await new Promise((e,t)=>{n.on("state_changed",void 0,t,()=>e())});let o=Date.now();try{let t=await fetch("/api/public-photos/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title||null,alt:e.alt||e.title||null,categoryId:e.categoryId,createdAt:o,masterPath:l})});if(!t.ok)throw Error(await t.text())}catch(t){await (0,r.gS)((0,r.rJ)(s.db,"public_photos"),{title:e.title||null,alt:e.alt||e.title||null,categoryId:e.categoryId,createdAt:o,published:!1,status:"processing",masterPath:l})}return{photoId:a,masterPath:l,createdAt:o}}async function c(e){let t=await fetch("/api/public-photos/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({photoId:e})});if(!t.ok)throw Error(await t.text())}function d(e){return e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}async function u(e){let{file:t,sessionId:a}=e,r=d(a)||d(t.name.split(".")[0]||"sessao"),l=(t.name.split(".").pop()||"jpg").toLowerCase(),n="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()),o="masters/sessions/".concat(r,"/").concat(n,".").concat(l),c=(0,i.bp)((0,i.KR)(s.I,o),t,{contentType:t.type});return await new Promise((e,t)=>{c.on("state_changed",void 0,t,()=>e())}),{photoId:n,masterPath:o,createdAt:Date.now(),sessionId:r}}async function p(e){var t,a,s,r;let i=await fetch("/api/session-photos/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e.sessionId,masterPath:e.masterPath,title:null!=(t=e.title)?t:null,alt:null!=(s=null!=(a=e.alt)?a:e.title)?s:null,createdAt:null!=(r=e.createdAt)?r:Date.now()})});if(!i.ok)throw Error(await i.text());return i.json().catch(()=>({}))}},4769:(e,t,a)=>{Promise.resolve().then(a.bind(a,890))},5801:(e,t,a)=>{"use strict";a.d(t,{T:()=>i});var s=a(8214),r=a(5317);async function i(){try{let e=await fetch("/api/categories",{cache:"no-store"});if(e.ok)return((await e.json()).items||[]).filter(e=>e.active)}catch(e){}let e=(0,r.P)((0,r.rJ)(s.db,"categories"),(0,r._M)("active","==",!0),(0,r.My)("name","asc"));return(await (0,r.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}},8214:(e,t,a)=>{"use strict";a.d(t,{I:()=>u,db:()=>d,j:()=>c});var s=a(3915),r=a(6203),i=a(5317),l=a(858),n=a(9509);let o=(0,s.Dk)().length?(0,s.Dk)()[0]:(0,s.Wp)({apiKey:"AIzaSyA8JlKiOAm4_8J7P77ZejpRbfm0liK1Gmk",authDomain:"gallery-e87e5.firebaseapp.com",projectId:"gallery-e87e5",storageBucket:"gallery-e87e5.firebasestorage.app",messagingSenderId:"799027183409",appId:"1:799027183409:web:24c7d316a8a523e7b7fa10",measurementId:"G-9WQWR0RHC6"}),c=(0,r.xI)(o),d=(0,i.aU)(o),u=(0,l.c7)(o);if("true"===n.env.NEXT_PUBLIC_FIREBASE_EMULATORS)try{(0,l.nb)(u,"localhost",9199)}catch(e){}}},e=>{e.O(0,[992,811,288,441,964,358],()=>e(e.s=4769)),_N_E=e.O()}]);