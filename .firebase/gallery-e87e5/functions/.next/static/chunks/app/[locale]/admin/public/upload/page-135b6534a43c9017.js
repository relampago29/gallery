(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33],{2289:(e,t,a)=>{"use strict";a.d(t,{Dv:()=>n,FC:()=>u,Gu:()=>l,UM:()=>o,XC:()=>p,fB:()=>c});var s=a(8214),i=a(5317),r=a(858);function l(e){let t=e.sizes||{},a=t["960"]||t["800"]||t["640"]||Object.values(t)[0];return(null==a?void 0:a.jpg)?{src:a.jpg,w:a.width,h:a.height}:{}}async function n(e){let{limitN:t,categoryId:a,cursor:r,forceApi:l}=e;try{var n;let e=new URLSearchParams;e.set("limit",String(t)),a&&e.set("categoryId",a),null!=r&&e.set("cursor",String(r));let s=await fetch("/api/public-photos/list?".concat(e.toString()),{cache:"no-store"});if(!s.ok)throw Error(await s.text());let i=await s.json();return{items:i.items||[],nextCursor:null!=(n=i.nextCursor)?n:null}}catch(e){if(l)throw Error((null==e?void 0:e.message)?String(e.message):String(e))}let o=[(0,i._M)("published","==",!0),(0,i.My)("createdAt","desc"),(0,i.AB)(t)];a&&o.unshift((0,i._M)("categoryId","==",a)),null!=r&&o.push((0,i.HM)(r));let c=(await (0,i.GG)((0,i.P)((0,i.rJ)(s.db,"public_photos"),...o))).docs.map(e=>({id:e.id,...e.data()})),d=c.length?c[c.length-1].createdAt:null;return{items:c,nextCursor:d}}async function o(e){let t=(e.file.name.split(".").pop()||"jpg").toLowerCase(),a="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()),l="masters/public/".concat(a,".").concat(t),n=(0,r.bp)((0,r.KR)(s.I,l),e.file,{contentType:e.file.type});await new Promise((e,t)=>{n.on("state_changed",void 0,t,()=>e())});let o=Date.now();try{let t=await fetch("/api/public-photos/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title||null,alt:e.alt||e.title||null,categoryId:e.categoryId,createdAt:o,masterPath:l})});if(!t.ok)throw Error(await t.text())}catch(t){await (0,i.gS)((0,i.rJ)(s.db,"public_photos"),{title:e.title||null,alt:e.alt||e.title||null,categoryId:e.categoryId,createdAt:o,published:!1,status:"processing",masterPath:l})}return{photoId:a,masterPath:l,createdAt:o}}async function c(e){let t=await fetch("/api/public-photos/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({photoId:e})});if(!t.ok)throw Error(await t.text())}function d(e){return e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}async function u(e){let{file:t,sessionId:a}=e,i=d(a)||d(t.name.split(".")[0]||"sessao"),l=(t.name.split(".").pop()||"jpg").toLowerCase(),n="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()),o="masters/sessions/".concat(i,"/").concat(n,".").concat(l),c=(0,r.bp)((0,r.KR)(s.I,o),t,{contentType:t.type});return await new Promise((e,t)=>{c.on("state_changed",void 0,t,()=>e())}),{photoId:n,masterPath:o,createdAt:Date.now(),sessionId:i}}async function p(e){var t,a,s,i;let r=await fetch("/api/session-photos/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e.sessionId,masterPath:e.masterPath,title:null!=(t=e.title)?t:null,alt:null!=(s=null!=(a=e.alt)?a:e.title)?s:null,createdAt:null!=(i=e.createdAt)?i:Date.now()})});if(!r.ok)throw Error(await r.text());return r.json().catch(()=>({}))}},3782:(e,t,a)=>{Promise.resolve().then(a.bind(a,6255))},5695:(e,t,a)=>{"use strict";var s=a(8999);a.o(s,"permanentRedirect")&&a.d(t,{permanentRedirect:function(){return s.permanentRedirect}}),a.o(s,"redirect")&&a.d(t,{redirect:function(){return s.redirect}}),a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},5801:(e,t,a)=>{"use strict";a.d(t,{T:()=>r});var s=a(8214),i=a(5317);async function r(){try{let e=await fetch("/api/categories",{cache:"no-store"});if(e.ok)return((await e.json()).items||[]).filter(e=>e.active)}catch(e){}let e=(0,i.P)((0,i.rJ)(s.db,"categories"),(0,i._M)("active","==",!0),(0,i.My)("name","asc"));return(await (0,i.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))}},6255:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),i=a(2115),r=a(5801),l=a(2289),n=a(5695);function o(){let e=(0,n.useParams)(),t=(null==e?void 0:e.locale)||"",[a,o]=(0,i.useState)([]),[c,d]=(0,i.useState)(""),[u,p]=(0,i.useState)([]),[h,m]=(0,i.useState)(""),[x,f]=(0,i.useState)(""),[b,g]=(0,i.useState)(!1),[w,v]=(0,i.useState)(null),[y,j]=(0,i.useState)("public"),[N,S]=(0,i.useState)([]),[k,C]=(0,i.useState)(48),[I,_]=(0,i.useState)([]),[P,A]=(0,i.useState)(""),E=(0,i.useMemo)(()=>P.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),[P]),[U,R]=(0,i.useState)(null);async function T(e){let t=[];for(let a of e)try{let e=await fetch("/api/storage/sign?path=".concat(encodeURIComponent(a.path),"&hours=").concat(k));if(e.ok){let s=await e.json();(null==s?void 0:s.url)&&t.push({name:a.name,url:s.url})}}catch(e){}return t}async function D(e){if(e.preventDefault(),"public"!==y||c&&0!==u.length){if("private"===y){if(0===u.length)return;if(!E)return void v("Escolhe um nome v\xe1lido para a sess\xe3o.")}g(!0),v(null);try{if("public"===y){for(let e of u)await (0,l.UM)({file:e,categoryId:c,title:h,alt:x});v("".concat(u.length," ficheiro(s) enviados para a pasta p\xfablica. As variantes ser\xe3o geradas automaticamente.")),S([])}else{let e=[];for(let t of u){let{masterPath:a,createdAt:s}=await (0,l.FC)({file:t,sessionId:E});await (0,l.XC)({sessionId:E,masterPath:a,title:t.name,createdAt:s}),e.push({name:t.name,path:a})}_(e);let a=await T(e);S(a);let s=function(e){let a=window.location.origin;return"".concat(a).concat(t?"/".concat(t):"","/sessions/").concat(e,"?hours=").concat(k)}(E);R({sessionId:E,url:s}),v("".concat(u.length,' ficheiro(s) enviados para "').concat(E,'". Links ').concat(a.length?"gerados":"ser\xe3o gerados em instantes"," por ").concat(k,"h."))}p([]),m(""),f("")}catch(e){v("Erro: "+((null==e?void 0:e.message)||String(e)))}finally{g(!1)}}}(0,i.useEffect)(()=>{(async()=>{let e=await (0,r.T)();o(e.map(e=>({id:e.id,name:e.name}))),e.length&&d(e[0].id)})()},[]),(0,i.useEffect)(()=>{"public"===y&&R(null)},[y]);let G="rounded-3xl border border-white/10 bg-white/5 shadow-[0_25px_120px_rgba(0,0,0,0.45)] backdrop-blur-sm",L="w-full rounded-2xl border border-white/15 bg-white/10 px-4 py-2 text-white placeholder-white/60 focus:border-white/50 focus:outline-none disabled:opacity-50",O="".concat(L," appearance-none"),J="rounded-full border border-white/30 px-4 py-1.5 text-sm text-white hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/50 disabled:opacity-40";return(0,s.jsxs)("main",{className:"relative min-h-screen overflow-hidden bg-[#030303] text-gray-100",children:[(0,s.jsxs)("div",{className:"pointer-events-none absolute inset-0 before:absolute before:inset-0 before:bg-[radial-gradient(circle_at_top,_rgba(255,255,255,0.1),_transparent_60%)] before:content-['']",children:[(0,s.jsx)("div",{className:"absolute -left-16 top-24 h-72 w-72 rounded-full bg-[#7c3aed1f] blur-3xl"}),(0,s.jsx)("div",{className:"absolute right-0 bottom-0 h-96 w-96 rounded-full bg-[#f472b61f] blur-3xl"})]}),(0,s.jsxs)("div",{className:"relative z-10 mx-auto max-w-5xl space-y-10 py-12 px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("header",{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-white/60",children:"Admin"}),(0,s.jsx)("h1",{className:"text-4xl font-semibold text-white tracking-tight",children:"Upload & Sess\xf5es"}),(0,s.jsx)("p",{className:"text-sm text-white/70",children:"Escolhe o destino, envia as fotos e partilha com o cliente atrav\xe9s de um link privado."})]}),(0,s.jsxs)("section",{className:G,children:[(0,s.jsxs)("form",{className:"space-y-6 p-6",onSubmit:D,children:[(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.25em] text-white/60",children:"Destino"}),(0,s.jsxs)("select",{className:O,value:y,onChange:e=>j(e.target.value),children:[(0,s.jsx)("option",{value:"public",children:"Pasta p\xfablica"}),(0,s.jsx)("option",{value:"private",children:"Pasta privada"})]})]}),(0,s.jsxs)("label",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.25em] text-white/60",children:"Categoria"}),(0,s.jsx)("select",{className:O,value:c,onChange:e=>d(e.target.value),disabled:"private"===y,children:a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))})]}),"private"===y&&(0,s.jsxs)("label",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.25em] text-white/60",children:"Validade do link"}),(0,s.jsxs)("select",{className:O,value:k,onChange:e=>C(Number(e.target.value)),children:[(0,s.jsx)("option",{value:24,children:"24 horas"}),(0,s.jsx)("option",{value:48,children:"48 horas"}),(0,s.jsx)("option",{value:168,children:"7 dias"})]})]}),"private"===y&&(0,s.jsxs)("label",{className:"space-y-2 sm:col-span-2",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.25em] text-white/60",children:"Nome da sess\xe3o"}),(0,s.jsx)("input",{className:L,placeholder:"Ex.: Sess\xe3o Joana & Rui",value:P,onChange:e=>A(e.target.value),required:"private"===y}),(0,s.jsx)("span",{className:"text-xs text-white/50",children:E?"Link base: /sessions/".concat(E):"Usa apenas letras e n\xfameros"})]}),(0,s.jsxs)("label",{className:"space-y-2",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.25em] text-white/60",children:"Ficheiros"}),(0,s.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"w-full rounded-2xl border border-dashed border-white/20 bg-white/5 px-4 py-8 text-sm text-white file:mr-4 file:rounded-full file:border-0 file:bg-white file:px-4 file:py-2 file:text-gray-900 hover:border-white/40",onChange:e=>p(Array.from(e.target.files||[])),required:!0})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsx)("input",{className:L,placeholder:"T\xedtulo (opcional)",value:h,onChange:e=>m(e.target.value),disabled:"private"===y}),(0,s.jsx)("input",{className:L,placeholder:"Alt (opcional)",value:x,onChange:e=>f(e.target.value),disabled:"private"===y})]}),u.length>0&&(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/70",children:["Selecionados: ",(0,s.jsx)("span",{className:"font-semibold text-white",children:u.length})," ficheiro(s)"]}),(0,s.jsx)("div",{className:"pt-2",children:(0,s.jsx)("button",{className:"inline-flex items-center justify-center rounded-full bg-white text-gray-900 px-6 py-2.5 text-sm font-semibold transition hover:bg-white/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white disabled:opacity-40",disabled:b||0===u.length||"public"===y&&!c||"private"===y&&!E,children:b?"A enviar…":"public"===y?"Guardar no portf\xf3lio":"Guardar sess\xe3o privada"})})]}),w&&(0,s.jsx)("div",{className:"border-t border-white/10 px-6 py-4 text-sm text-white/80",children:w})]}),"private"===y&&(0,s.jsxs)("section",{className:G,children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 border-b border-white/10 px-6 py-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("span",{className:"text-sm text-white/70",children:["Links de download (v\xe1lidos por ",k,"h)"]}),I.length>0&&(0,s.jsx)("button",{type:"button",className:J,onClick:async()=>{g(!0);try{let e=await T(I);S(e),e.length||v("Ainda a preparar os ficheiros. Tenta novamente em alguns segundos.")}finally{g(!1)}},disabled:b,children:"Gerar links"})]}),0===N.length?(0,s.jsx)("div",{className:"px-6 py-5 text-sm text-white/60",children:"Sem links ainda. Assim que os ficheiros ficarem vis\xedveis, clica em “Gerar links”."}):(0,s.jsx)("ul",{className:"space-y-3 px-6 py-5",children:N.map((e,t)=>(0,s.jsxs)("li",{className:"flex flex-col gap-2 rounded-2xl border border-white/10 bg-white/5 p-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{className:"truncate",children:[(0,s.jsx)("div",{className:"font-medium text-white truncate",children:e.name}),(0,s.jsx)("a",{className:"text-xs text-white/70 break-all hover:text-white",href:e.url,target:"_blank",rel:"noreferrer",children:e.url})]}),(0,s.jsx)("button",{type:"button",className:J,onClick:()=>navigator.clipboard.writeText(e.url),children:"Copiar"})]},t))}),U&&(0,s.jsxs)("div",{className:"border-t border-white/10 px-6 py-5 space-y-2",children:[(0,s.jsxs)("div",{className:"text-sm font-semibold text-white",children:["Link geral da sess\xe3o (",U.sessionId,")"]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsx)("a",{className:"text-sm text-white/80 break-all hover:text-white",href:U.url,target:"_blank",rel:"noreferrer",children:U.url}),(0,s.jsx)("button",{type:"button",className:J,onClick:()=>navigator.clipboard.writeText(U.url),children:"Copiar"})]}),(0,s.jsxs)("p",{className:"text-xs text-white/60",children:["Junta todas as fotos enviadas nesta sess\xe3o e expira em ",k,"h."]})]})]})]})]})}},8214:(e,t,a)=>{"use strict";a.d(t,{I:()=>u,db:()=>d,j:()=>c});var s=a(3915),i=a(6203),r=a(5317),l=a(858),n=a(9509);let o=(0,s.Dk)().length?(0,s.Dk)()[0]:(0,s.Wp)({apiKey:"AIzaSyA8JlKiOAm4_8J7P77ZejpRbfm0liK1Gmk",authDomain:"gallery-e87e5.firebaseapp.com",projectId:"gallery-e87e5",storageBucket:"gallery-e87e5.firebasestorage.app",messagingSenderId:"799027183409",appId:"1:799027183409:web:24c7d316a8a523e7b7fa10",measurementId:"G-9WQWR0RHC6"}),c=(0,i.xI)(o),d=(0,r.aU)(o),u=(0,l.c7)(o);if("true"===n.env.NEXT_PUBLIC_FIREBASE_EMULATORS)try{(0,l.nb)(u,"localhost",9199)}catch(e){}}},e=>{e.O(0,[992,811,288,441,964,358],()=>e(e.s=3782)),_N_E=e.O()}]);