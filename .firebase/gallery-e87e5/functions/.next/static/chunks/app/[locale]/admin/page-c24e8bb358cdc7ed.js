(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[89],{388:(e,t,s)=>{"use strict";s.d(t,{N_:()=>r,a8:()=>l});var a=s(981);let i=(0,s(9984).A)({locales:["pt","en"],defaultLocale:"pt",localePrefix:"always"}),{Link:r,usePathname:l,useRouter:o,redirect:n,getPathname:c}=(0,a.A)(i)},2289:(e,t,s)=>{"use strict";s.d(t,{Dv:()=>o,FC:()=>p,Gu:()=>l,UM:()=>n,XC:()=>u,fB:()=>c});var a=s(8214),i=s(5317),r=s(858);function l(e){let t=e.sizes||{},s=t["960"]||t["800"]||t["640"]||Object.values(t)[0];return(null==s?void 0:s.jpg)?{src:s.jpg,w:s.width,h:s.height}:{}}async function o(e){let{limitN:t,categoryId:s,cursor:r,forceApi:l}=e;try{var o;let e=new URLSearchParams;e.set("limit",String(t)),s&&e.set("categoryId",s),null!=r&&e.set("cursor",String(r));let a=await fetch("/api/public-photos/list?".concat(e.toString()),{cache:"no-store"});if(!a.ok)throw Error(await a.text());let i=await a.json();return{items:i.items||[],nextCursor:null!=(o=i.nextCursor)?o:null}}catch(e){if(l)throw Error((null==e?void 0:e.message)?String(e.message):String(e))}let n=[(0,i._M)("published","==",!0),(0,i.My)("createdAt","desc"),(0,i.AB)(t)];s&&n.unshift((0,i._M)("categoryId","==",s)),null!=r&&n.push((0,i.HM)(r));let c=(await (0,i.GG)((0,i.P)((0,i.rJ)(a.db,"public_photos"),...n))).docs.map(e=>({id:e.id,...e.data()})),d=c.length?c[c.length-1].createdAt:null;return{items:c,nextCursor:d}}async function n(e){let t=(e.file.name.split(".").pop()||"jpg").toLowerCase(),s="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()),l="masters/public/".concat(s,".").concat(t),o=(0,r.bp)((0,r.KR)(a.I,l),e.file,{contentType:e.file.type});await new Promise((e,t)=>{o.on("state_changed",void 0,t,()=>e())});let n=Date.now();try{let t=await fetch("/api/public-photos/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title||null,alt:e.alt||e.title||null,categoryId:e.categoryId,createdAt:n,masterPath:l})});if(!t.ok)throw Error(await t.text())}catch(t){await (0,i.gS)((0,i.rJ)(a.db,"public_photos"),{title:e.title||null,alt:e.alt||e.title||null,categoryId:e.categoryId,createdAt:n,published:!1,status:"processing",masterPath:l})}return{photoId:s,masterPath:l,createdAt:n}}async function c(e){let t=await fetch("/api/public-photos/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({photoId:e})});if(!t.ok)throw Error(await t.text())}function d(e){return e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}async function p(e){let{file:t,sessionId:s}=e,i=d(s)||d(t.name.split(".")[0]||"sessao"),l=(t.name.split(".").pop()||"jpg").toLowerCase(),o="undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():String(Date.now()),n="masters/sessions/".concat(i,"/").concat(o,".").concat(l),c=(0,r.bp)((0,r.KR)(a.I,n),t,{contentType:t.type});return await new Promise((e,t)=>{c.on("state_changed",void 0,t,()=>e())}),{photoId:o,masterPath:n,createdAt:Date.now(),sessionId:i}}async function u(e){var t,s,a,i;let r=await fetch("/api/session-photos/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e.sessionId,masterPath:e.masterPath,title:null!=(t=e.title)?t:null,alt:null!=(a=null!=(s=e.alt)?s:e.title)?a:null,createdAt:null!=(i=e.createdAt)?i:Date.now()})});if(!r.ok)throw Error(await r.text());return r.json().catch(()=>({}))}},5738:(e,t,s)=>{Promise.resolve().then(s.bind(s,6160)),Promise.resolve().then(s.bind(s,9337))},8214:(e,t,s)=>{"use strict";s.d(t,{I:()=>p,db:()=>d,j:()=>c});var a=s(3915),i=s(6203),r=s(5317),l=s(858),o=s(9509);let n=(0,a.Dk)().length?(0,a.Dk)()[0]:(0,a.Wp)({apiKey:"AIzaSyA8JlKiOAm4_8J7P77ZejpRbfm0liK1Gmk",authDomain:"gallery-e87e5.firebaseapp.com",projectId:"gallery-e87e5",storageBucket:"gallery-e87e5.firebasestorage.app",messagingSenderId:"799027183409",appId:"1:799027183409:web:24c7d316a8a523e7b7fa10",measurementId:"G-9WQWR0RHC6"}),c=(0,i.xI)(n),d=(0,r.aU)(n),p=(0,l.c7)(n);if("true"===o.env.NEXT_PUBLIC_FIREBASE_EMULATORS)try{(0,l.nb)(p,"localhost",9199)}catch(e){}},9337:(e,t,s)=>{"use strict";s.d(t,{PublicPreviewGrid:()=>o});var a=s(5155),i=s(2115),r=s(2289),l=s(388);function o(e){let{locale:t,seeAllHref:s}=e,[o,n]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[p,u]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/public-photos/list?limit=12",{cache:"no-store"});if(!e.ok)throw Error(await e.text());let t=await e.json();n(Array.isArray(t.items)?t.items:[])}catch(e){u((null==e?void 0:e.message)||"Falha ao carregar as fotos."),n([])}finally{d(!1)}})()},[]),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.35em] text-white/60",children:"Portf\xf3lio"}),(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"\xdaltimos uploads p\xfablicos"})]}),(0,a.jsx)(l.N_,{href:s,locale:t,className:"inline-flex items-center justify-center rounded-full border border-white/30 px-4 py-1.5 text-sm text-white transition hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/60",children:"Ver todos"})]}),(0,a.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 shadow-[0_25px_120px_rgba(0,0,0,0.45)] backdrop-blur-sm",children:c?(0,a.jsx)("div",{className:"py-10 text-center text-sm text-white/60",children:"A carregar…"}):p?(0,a.jsx)("div",{className:"rounded-2xl border border-red-400/40 bg-red-500/10 p-4 text-sm text-red-100",children:p.includes("index")?"Precisas de publicar o \xedndice no Firestore.":p}):0===o.length?(0,a.jsx)("div",{className:"py-10 text-center text-sm text-white/60",children:"Ainda n\xe3o existem fotos p\xfablicas. Faz upload para come\xe7ar."}):(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:o.map(e=>{let t=(0,r.Gu)(e);return(0,a.jsxs)("div",{className:"overflow-hidden rounded-3xl border border-white/10 bg-white/5 shadow-[0_20px_80px_rgba(0,0,0,0.45)] backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"aspect-[4/3] bg-white/10",children:t.src?(0,a.jsx)("img",{src:t.src,alt:e.alt||e.title||"foto",className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"flex h-full items-center justify-center text-xs text-white/70",children:"processing"===e.status?"A gerar variantes…":"Sem preview"})}),(0,a.jsxs)("div",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"truncate text-sm font-medium text-white",children:e.title||"(sem t\xedtulo)"}),(0,a.jsx)("div",{className:"text-xs uppercase tracking-wide text-white/50",children:e.status||"–"})]})]},e.id)})})})]})}}},e=>{e.O(0,[992,811,288,797,55,441,964,358],()=>e(e.s=5738)),_N_E=e.O()}]);